import{bj as u,bu as l,bs as d,bt as j,l as A,o as f,bG as P,aC as p,a3 as h}from"./main-oBfCarfk.js";const b=u((e,c)=>({userProjects:[],userArtifacts:[],sessionArtifacts:{},isLoadingProjects:!1,isLoadingArtifacts:!1,projectsError:null,artifactsError:null,currentProjectId:null,activeTab:"opened",fetchUserProjects:async r=>{const s=c().userProjects.length>0;s||e({isLoadingProjects:!0,projectsError:null});try{const t=await h({data:{userId:r}});t.success&&t.projects?e({userProjects:t.projects,isLoadingProjects:!1}):e({projectsError:t.error||"Failed to fetch projects",isLoadingProjects:!1})}catch{s||e({projectsError:"Failed to fetch projects",isLoadingProjects:!1})}},fetchUserArtifacts:async r=>{e({isLoadingArtifacts:!0,artifactsError:null});try{const s=await p({data:{userId:r}});s.success&&s.artifacts?e({userArtifacts:s.artifacts,isLoadingArtifacts:!1}):e({artifactsError:s.error||"Failed to fetch artifacts",isLoadingArtifacts:!1})}catch{e({artifactsError:"Failed to fetch artifacts",isLoadingArtifacts:!1})}},fetchSessionArtifacts:async(r,s)=>{try{const t=await P({data:{userId:r,sessionId:s}});t.success&&t.artifacts&&e(i=>({sessionArtifacts:{...i.sessionArtifacts,[s]:t.artifacts}}))}catch(t){console.error("Failed to fetch session artifacts:",t)}},getAllUserProjects:()=>c().userProjects,getScheduledProjects:()=>c().userProjects.filter(r=>f(r.startDate,r.endDate)==="scheduled"),getOpenedProjects:()=>c().userProjects.filter(r=>f(r.startDate,r.endDate)==="opened"),getClosedProjects:()=>c().userProjects.filter(r=>f(r.startDate,r.endDate)==="closed"),getWorkspaceMode:()=>c().userProjects.length>0?"active":"onboarding",setCurrentProject:r=>{e({currentProjectId:r})},setActiveTab:r=>{e({activeTab:r})},joinProject:async(r,s)=>{try{const t=await A({data:{userId:r,code:s}});return t.success&&t.projectId?(await c().fetchUserProjects(r),{success:!0,projectId:t.projectId}):{success:!1,error:t.error||"Failed to join project"}}catch{return{success:!1,error:"Failed to join project"}}},createArtifact:async r=>{try{const s=await j({data:r});return s.success&&s.artifactId?(await c().fetchSessionArtifacts(r.userId,r.sessionId),{success:!0,artifactId:s.artifactId}):{success:!1,error:s.error||"Failed to create artifact"}}catch{return{success:!1,error:"Failed to create artifact"}}},updateArtifact:async(r,s)=>{try{const t=await d({data:{artifactId:r,...s}});return t.success?(e(i=>{const a={...i.sessionArtifacts};for(const n of Object.keys(a))a[n]=a[n].map(o=>o.id===r?{...o,...s,updatedAt:new Date().toISOString()}:o);return{sessionArtifacts:a}}),{success:!0}):{success:!1,error:t.error||"Failed to update artifact"}}catch{return{success:!1,error:"Failed to update artifact"}}},submitArtifact:async(r,s)=>{try{const t=await l({data:{artifactId:r,userId:s}});return t.success&&t.version?(e(i=>{const a={...i.sessionArtifacts};for(const n of Object.keys(a))a[n]=a[n].map(o=>o.id===r?{...o,status:"submitted",latestVersion:t.version,updatedAt:new Date().toISOString()}:o);return{sessionArtifacts:a}}),{success:!0,version:t.version}):{success:!1,error:t.error||"Failed to submit artifact"}}catch{return{success:!1,error:"Failed to submit artifact"}}},getSessionArtifact:r=>c().sessionArtifacts[r]?.[0],clearCache:()=>{e({userProjects:[],userArtifacts:[],sessionArtifacts:{},projectsError:null,artifactsError:null})}}));export{b as u};
