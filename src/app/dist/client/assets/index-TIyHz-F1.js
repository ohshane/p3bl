import{u as H,bZ as J,a as X,a4 as Y,r as a,t as l,b_ as $,j as e,B as C,bI as K,U as k,W as I,Y as U,Z as F,ba as Q,_ as B,k as ee,e as S,d as A,ap as se,aq as te,ar as re,as as ae,R as z,T as M,V as O,X as ne,b0 as ie,b1 as oe,b2 as de,b3 as ce,b4 as le,b5 as me,b6 as xe,b7 as ue,E as he,z as ge}from"./main-oBfCarfk.js";import{U as je}from"./user-minus-DC-NG7pw.js";const fe=1e4;function E({id:d,name:t,email:g,avatar:n,joinedAt:j,onRemove:f}){const b=t.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"flex items-center gap-3 bg-card border border-border rounded-lg p-3 group hover:border-muted-foreground/30 transition-colors",children:[e.jsxs(z,{children:[n?e.jsx(M,{src:n,alt:t}):null,e.jsx(O,{children:b})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:t}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:g})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(I,{children:e.jsxs(U,{children:[e.jsx(F,{asChild:!0,children:e.jsxs("span",{className:"text-xs text-muted-foreground hidden sm:inline-flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),ge(new Date(j),{addSuffix:!0})]})}),e.jsx(B,{children:e.jsxs("p",{children:["Joined ",new Date(j).toLocaleString()]})})]})}),e.jsx("button",{type:"button",onClick:()=>f(d,t),className:"p-1.5 rounded-md text-destructive/60 hover:text-destructive hover:bg-destructive/10 transition-colors",children:e.jsx(je,{className:"w-3.5 h-3.5"})})]})]})}function be(){const d=H(),{projectId:t}=J.useParams(),{isAuthenticated:g,currentUser:n}=X(),{getProject:j,fetchProjects:f,getParticipants:b,fetchParticipants:o,removeParticipant:T}=Y(),m=j(t),r=b(t),[P,R]=a.useState(!0),[p,v]=a.useState(null),[D,L]=a.useState(!1),[W,N]=a.useState(new Date);a.useEffect(()=>{g||d({to:"/"})},[g,d]),a.useEffect(()=>{n&&!n.role.includes("creator")&&d({to:"/explorer"})},[n,d]),a.useEffect(()=>{n?.id&&!m&&f(n.id)},[n?.id,m,f]),a.useEffect(()=>{(async()=>(R(!0),await o(t),R(!1),N(new Date)))()},[t,o]),a.useEffect(()=>{const s=setInterval(async()=>{await o(t),N(new Date)},fe);return()=>clearInterval(s)},[t,o]);const _=a.useCallback(async()=>{await o(t),N(new Date)},[t,o]),V=a.useCallback(async s=>{L(!0);try{await T(t,s)?l.success("Participant removed"):l.error("Failed to remove participant")}catch{l.error("Failed to remove participant")}finally{L(!1),v(null)}},[t,T]),Z=a.useCallback(async s=>{try{(await $({data:{projectId:t,userId:s}})).success?(l.success("Participant unremoved"),await o(t)):l.error("Failed to unremove participant")}catch{l.error("Failed to unremove participant")}},[t,o]);if(!n||!n.role.includes("creator"))return null;if(!m)return e.jsx("div",{className:"container max-w-5xl mx-auto py-8 px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Project Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The project you're looking for doesn't exist."}),e.jsx(C,{onClick:()=>d({to:"/creator"}),children:"Back to Dashboard"})]})});const x=new Map;if(r)for(const s of r.assigned){const i=s.teamId;x.has(i)||x.set(i,{teamName:s.teamName,members:[]}),x.get(i).members.push(s)}const w=r?.waiting.length??0;r?.assigned.length;const u=r?.removed?.length??0,y=x.size;return e.jsxs("div",{className:"min-h-[calc(100vh-4rem)] bg-background",children:[e.jsxs("div",{className:"container max-w-5xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(C,{variant:"ghost",onClick:()=>d({to:"/creator/project/$projectId",params:{projectId:t}}),className:"mb-4 text-muted-foreground hover:text-foreground",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Back to Project"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 text-cyan-500"}),"Participants"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:m.name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Updates every 10s"}),e.jsx(I,{children:e.jsxs(U,{children:[e.jsx(F,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",onClick:_,className:"border-border",children:e.jsx(Q,{className:"w-4 h-4"})})}),e.jsx(B,{children:e.jsxs("p",{children:["Refresh now (last:"," ",W.toLocaleTimeString(),")"]})})]})})]})]})]}),e.jsxs("div",{className:ee("grid gap-4 mb-8",u>0?"grid-cols-4":"grid-cols-3"),children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total??0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Participants"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:y}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Teams"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-500",children:w}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Waiting for Team"})]}),u>0&&e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive/70",children:u}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Removed"})]})]}),P&&!r&&e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(S,{className:"w-6 h-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Loading participants..."})]}),!P&&r&&r.total===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground/40 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-1",children:"No participants yet"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Share the join code"," ",e.jsx("span",{className:"font-mono font-bold text-foreground",children:m.joinCode})," ","to invite explorers."]})]}),r&&w>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Waiting for Team Assignment"}),e.jsx(A,{variant:"outline",className:"bg-amber-500/10 text-amber-500 border-amber-500/30 text-xs",children:w})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:r.waiting.map(s=>e.jsx(E,{id:s.id,name:s.name,email:s.email,avatar:s.avatar,joinedAt:s.joinedAt,onRemove:(i,h)=>v({id:i,name:h})},s.id))})]}),r&&y>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider mb-4",children:["Teams (",y,")"]}),e.jsx("div",{className:"space-y-4",children:Array.from(x.entries()).map(([s,{teamName:i,members:h}])=>e.jsx(se,{defaultOpen:!0,children:e.jsxs("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:[e.jsxs(te,{className:"w-full flex items-center justify-between p-4 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-4 h-4 text-cyan-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:i}),e.jsxs(A,{variant:"outline",className:"bg-cyan-500/10 text-cyan-500 border-cyan-500/30 text-xs",children:[h.length," ",h.length===1?"member":"members"]})]}),e.jsx(re,{className:"w-4 h-4 text-muted-foreground transition-transform duration-200 [[data-state=open]>&]:rotate-180"})]}),e.jsx(ae,{children:e.jsx("div",{className:"border-t border-border px-4 pb-4 pt-3",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:h.map(c=>e.jsx(E,{id:c.id,name:c.name,email:c.email,avatar:c.avatar,joinedAt:c.joinedAt,onRemove:(q,G)=>v({id:q,name:G})},c.id))})})})]})},s))})]}),r&&u>0&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Removed"}),e.jsx(A,{variant:"outline",className:"bg-destructive/10 text-destructive border-destructive/30 text-xs",children:u})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:r.removed.map(s=>e.jsxs("div",{className:"flex items-center gap-3 bg-card border border-border rounded-lg p-3",children:[e.jsxs(z,{children:[s.avatar?e.jsx(M,{src:s.avatar,alt:s.name}):null,e.jsx(O,{children:s.name.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.email})]}),e.jsx("button",{type:"button",onClick:()=>Z(s.id),className:"p-1.5 rounded-md text-muted-foreground hover:text-foreground hover:bg-muted transition-colors",children:e.jsx(ne,{className:"w-3.5 h-3.5"})})]},s.id))})]})]}),e.jsx(ie,{open:!!p,onOpenChange:s=>!s&&v(null),children:e.jsxs(oe,{className:"bg-card border-border",children:[e.jsxs(de,{children:[e.jsx(ce,{className:"text-foreground",children:"Remove Participant"}),e.jsxs(le,{className:"text-muted-foreground",children:["Are you sure you want to remove"," ",e.jsx("span",{className:"font-medium text-foreground",children:p?.name})," ","from this project? They will be removed from their team and their invitation will be revoked. This action cannot be undone."]})]}),e.jsxs(me,{children:[e.jsx(xe,{className:"border-border text-muted-foreground hover:bg-muted",children:"Cancel"}),e.jsx(ue,{className:"bg-destructive text-white hover:bg-destructive/90 dark:bg-destructive/60",disabled:D,onClick:async()=>{p&&await V(p.id)},children:D?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Removing..."]}):"Remove"})]})]})})]})}export{be as component};
