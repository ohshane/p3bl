import{c as ht,u as ve,r as n,a as U,j as e,B as V,e as q,X as pt,i as Te,t as E,k as ue,l as We,m as _e,n as ft,o as Ue,p as ze,q as Je,s as gt,P as jt,v as vt,w as Nt,x as bt,y as yt,z as wt,b as Ge,A as Ct,U as Ne,D as ae,E as Ye,F as _,G as be,d as St,H as It,J as Dt,K as Mt,M as Et,N as Pt,Q as Tt,L as kt,R as At,T as Ot,V as Lt,W as ke,Y as Ae,Z as Oe,_ as Le,$ as Ft,a0 as je,a1 as Bt,a2 as Rt,a3 as Ht}from"./main-oBfCarfk.js";import{C as X,a as Z,b as $t}from"./card-C5iuDLNY.js";import{A as Fe,a as Be}from"./alert-C8I4vCtu.js";import{A as Wt}from"./arrow-right-CbZwLqfA.js";import{C as Re}from"./circle-alert-CGSAmO4T.js";import{u as _t}from"./projectStore-Dn8I5Khp.js";import{T as Ut,a as zt,b as oe,c as ie}from"./tabs-DVTc6-Rb.js";import{L as Ve}from"./layers-CCP3i8KU.js";import{F as qe}from"./folder-open-EaNXFIAV.js";import{C as Xe}from"./circle-check-big-CihxHQxh.js";import{L as He,B as Jt,S as Ze,P as Gt,a as Yt,M as Vt,b as qt,H as Xt,c as Zt,d as Kt,F as Qt,e as es}from"./index-zHnbUOvX.js";import{C as ts}from"./chevron-right-DzRrl-eW.js";import{s as ss,e as as,a as ns,i as rs,b as ls}from"./isSameMonth-RY1uWspo.js";const os=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],is=ht("mail",os);function cs({invitation:t,onDismiss:s}){const a=ve(),[l,m]=n.useState(!1),[c,h]=n.useState(!1),{addJoinedProject:o}=U(),r=async()=>{m(!0);try{const p=await Te({data:{invitationId:t.id,accept:!0}});if(!p.success){E.error(p.error||"Failed to join project"),m(!1);return}o(p.projectId),E.success(`Welcome to ${t.projectName}!`,{description:"You have successfully joined the project."}),a({to:`/explorer/project/${p.projectId}`})}catch(p){console.error("Join project error:",p),E.error("Failed to join project. Please try again."),m(!1)}},d=async()=>{h(!0);try{const p=await Te({data:{invitationId:t.id,accept:!1}});if(!p.success){E.error(p.error||"Failed to dismiss invitation"),h(!1);return}E.info("Invitation dismissed",{description:"You can still join later with a code."}),s?.(t.id)}catch(p){console.error("Dismiss invitation error:",p),E.error("Failed to dismiss invitation. Please try again.")}finally{h(!1)}},f=l||c;return e.jsx(X,{className:"bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border-cyan-500/30",children:e.jsxs(Z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center shrink-0",children:e.jsx(is,{className:"w-6 h-6 text-cyan-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-cyan-400 font-medium mb-1",children:"You're invited!"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground truncate",children:t.projectName})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(V,{onClick:r,disabled:f,className:"flex-1 bg-cyan-600 hover:bg-cyan-700",children:l?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}),"Joining..."]}):"Join"}),e.jsx(V,{variant:"outline",onClick:d,disabled:f,className:"border-muted-foreground/30",children:c?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Dismiss"]})})]})]})})}var ds=Object.defineProperty,us=Object.defineProperties,ms=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,$e=(t,s,a)=>s in t?ds(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,xs=(t,s)=>{for(var a in s||(s={}))Ke.call(s,a)&&$e(t,a,s[a]);if(me)for(var a of me(s))Qe.call(s,a)&&$e(t,a,s[a]);return t},hs=(t,s)=>us(t,ms(s)),ps=(t,s)=>{var a={};for(var l in t)Ke.call(t,l)&&s.indexOf(l)<0&&(a[l]=t[l]);if(t!=null&&me)for(var l of me(t))s.indexOf(l)<0&&Qe.call(t,l)&&(a[l]=t[l]);return a};function fs(t){let s=setTimeout(t,0),a=setTimeout(t,10),l=setTimeout(t,50);return[s,a,l]}function gs(t){let s=n.useRef();return n.useEffect(()=>{s.current=t}),s.current}var js=18,et=40,vs=`${et}px`,Ns=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function bs({containerRef:t,inputRef:s,pushPasswordManagerStrategy:a,isFocused:l}){let[m,c]=n.useState(!1),[h,o]=n.useState(!1),[r,d]=n.useState(!1),f=n.useMemo(()=>a==="none"?!1:(a==="increase-width"||a==="experimental-no-flickering")&&m&&h,[m,h,a]),p=n.useCallback(()=>{let i=t.current,b=s.current;if(!i||!b||r||a==="none")return;let g=i,S=g.getBoundingClientRect().left+g.offsetWidth,k=g.getBoundingClientRect().top+g.offsetHeight/2,j=S-js,v=k;document.querySelectorAll(Ns).length===0&&document.elementFromPoint(j,v)===i||(c(!0),d(!0))},[t,s,r,a]);return n.useEffect(()=>{let i=t.current;if(!i||a==="none")return;function b(){let S=window.innerWidth-i.getBoundingClientRect().right;o(S>=et)}b();let g=setInterval(b,1e3);return()=>{clearInterval(g)}},[t,a]),n.useEffect(()=>{let i=l||document.activeElement===s.current;if(a==="none"||!i)return;let b=setTimeout(p,0),g=setTimeout(p,2e3),S=setTimeout(p,5e3),k=setTimeout(()=>{d(!0)},6e3);return()=>{clearTimeout(b),clearTimeout(g),clearTimeout(S),clearTimeout(k)}},[s,l,a,p]),{hasPWMBadge:m,willPushPWMBadge:f,PWM_BADGE_SPACE_WIDTH:vs}}var tt=n.createContext({}),st=n.forwardRef((t,s)=>{var a=t,{value:l,onChange:m,maxLength:c,textAlign:h="left",pattern:o,placeholder:r,inputMode:d="numeric",onComplete:f,pushPasswordManagerStrategy:p="increase-width",pasteTransformer:i,containerClassName:b,noScriptCSSFallback:g=ys,render:S,children:k}=a,j=ps(a,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),v,F,z,ne,ye;let[rt,lt]=n.useState(typeof j.defaultValue=="string"?j.defaultValue:""),y=l??rt,B=gs(y),K=n.useCallback(u=>{m?.(u),lt(u)},[m]),T=n.useMemo(()=>o?typeof o=="string"?new RegExp(o):o:null,[o]),w=n.useRef(null),xe=n.useRef(null),he=n.useRef({value:y,onChange:K,isIOS:typeof window<"u"&&((F=(v=window?.CSS)==null?void 0:v.supports)==null?void 0:F.call(v,"-webkit-touch-callout","none"))}),re=n.useRef({prev:[(z=w.current)==null?void 0:z.selectionStart,(ne=w.current)==null?void 0:ne.selectionEnd,(ye=w.current)==null?void 0:ye.selectionDirection]});n.useImperativeHandle(s,()=>w.current,[]),n.useEffect(()=>{let u=w.current,x=xe.current;if(!u||!x)return;he.current.value!==u.value&&he.current.onChange(u.value),re.current.prev=[u.selectionStart,u.selectionEnd,u.selectionDirection];function C(){if(document.activeElement!==u){ee(null),te(null);return}let N=u.selectionStart,I=u.selectionEnd,le=u.selectionDirection,P=u.maxLength,H=u.value,A=re.current.prev,O=-1,L=-1,$;if(H.length!==0&&N!==null&&I!==null){let ut=N===I,mt=N===H.length&&H.length<P;if(ut&&!mt){let W=N;if(W===0)O=0,L=1,$="forward";else if(W===P)O=W-1,L=W,$="backward";else if(P>1&&H.length>1){let ge=0;if(A[0]!==null&&A[1]!==null){$=W<A[1]?"backward":"forward";let xt=A[0]===A[1]&&A[0]<P;$==="backward"&&!xt&&(ge=-1)}O=ge+W,L=ge+W+1}}O!==-1&&L!==-1&&O!==L&&w.current.setSelectionRange(O,L,$)}let Ee=O!==-1?O:N,Pe=L!==-1?L:I,dt=$??le;ee(Ee),te(Pe),re.current.prev=[Ee,Pe,dt]}if(document.addEventListener("selectionchange",C,{capture:!0}),C(),document.activeElement===u&&pe(!0),!document.getElementById("input-otp-style")){let N=document.createElement("style");if(N.id="input-otp-style",document.head.appendChild(N),N.sheet){let I="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";se(N.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),se(N.sheet,`[data-input-otp]:autofill { ${I} }`),se(N.sheet,`[data-input-otp]:-webkit-autofill { ${I} }`),se(N.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),se(N.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let D=()=>{x&&x.style.setProperty("--root-height",`${u.clientHeight}px`)};D();let M=new ResizeObserver(D);return M.observe(u),()=>{document.removeEventListener("selectionchange",C,{capture:!0}),M.disconnect()}},[]);let[we,Ce]=n.useState(!1),[Q,pe]=n.useState(!1),[R,ee]=n.useState(null),[J,te]=n.useState(null);n.useEffect(()=>{fs(()=>{var u,x,C,D;(u=w.current)==null||u.dispatchEvent(new Event("input"));let M=(x=w.current)==null?void 0:x.selectionStart,N=(C=w.current)==null?void 0:C.selectionEnd,I=(D=w.current)==null?void 0:D.selectionDirection;M!==null&&N!==null&&(ee(M),te(N),re.current.prev=[M,N,I])})},[y,Q]),n.useEffect(()=>{B!==void 0&&y!==B&&B.length<c&&y.length===c&&f?.(y)},[c,f,B,y]);let G=bs({containerRef:xe,inputRef:w,pushPasswordManagerStrategy:p,isFocused:Q}),Se=n.useCallback(u=>{let x=u.currentTarget.value.slice(0,c);if(x.length>0&&T&&!T.test(x)){u.preventDefault();return}typeof B=="string"&&x.length<B.length&&document.dispatchEvent(new Event("selectionchange")),K(x)},[c,K,B,T]),Ie=n.useCallback(()=>{var u;if(w.current){let x=Math.min(w.current.value.length,c-1),C=w.current.value.length;(u=w.current)==null||u.setSelectionRange(x,C),ee(x),te(C)}pe(!0)},[c]),De=n.useCallback(u=>{var x,C;let D=w.current;if(!i&&(!he.current.isIOS||!u.clipboardData||!D))return;let M=u.clipboardData.getData("text/plain"),N=i?i(M):M;u.preventDefault();let I=(x=w.current)==null?void 0:x.selectionStart,le=(C=w.current)==null?void 0:C.selectionEnd,P=(I!==le?y.slice(0,I)+N+y.slice(le):y.slice(0,I)+N+y.slice(I)).slice(0,c);if(P.length>0&&T&&!T.test(P))return;D.value=P,K(P);let H=Math.min(P.length,c-1),A=P.length;D.setSelectionRange(H,A),ee(H),te(A)},[c,K,T,y]),ot=n.useMemo(()=>({position:"relative",cursor:j.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[j.disabled]),Me=n.useMemo(()=>({position:"absolute",inset:0,width:G.willPushPWMBadge?`calc(100% + ${G.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:G.willPushPWMBadge?`inset(0 ${G.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:h,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[G.PWM_BADGE_SPACE_WIDTH,G.willPushPWMBadge,h]),it=n.useMemo(()=>n.createElement("input",hs(xs({autoComplete:j.autoComplete||"one-time-code"},j),{"data-input-otp":!0,"data-input-otp-placeholder-shown":y.length===0||void 0,"data-input-otp-mss":R,"data-input-otp-mse":J,inputMode:d,pattern:T?.source,"aria-placeholder":r,style:Me,maxLength:c,value:y,ref:w,onPaste:u=>{var x;De(u),(x=j.onPaste)==null||x.call(j,u)},onChange:Se,onMouseOver:u=>{var x;Ce(!0),(x=j.onMouseOver)==null||x.call(j,u)},onMouseLeave:u=>{var x;Ce(!1),(x=j.onMouseLeave)==null||x.call(j,u)},onFocus:u=>{var x;Ie(),(x=j.onFocus)==null||x.call(j,u)},onBlur:u=>{var x;pe(!1),(x=j.onBlur)==null||x.call(j,u)}})),[Se,Ie,De,d,Me,c,J,R,j,T?.source,y]),fe=n.useMemo(()=>({slots:Array.from({length:c}).map((u,x)=>{var C;let D=Q&&R!==null&&J!==null&&(R===J&&x===R||x>=R&&x<J),M=y[x]!==void 0?y[x]:null,N=y[0]!==void 0?null:(C=r?.[x])!=null?C:null;return{char:M,placeholderChar:N,isActive:D,hasFakeCaret:D&&M===null}}),isFocused:Q,isHovering:!j.disabled&&we}),[Q,we,c,J,R,j.disabled,y]),ct=n.useMemo(()=>S?S(fe):n.createElement(tt.Provider,{value:fe},k),[k,fe,S]);return n.createElement(n.Fragment,null,g!==null&&n.createElement("noscript",null,n.createElement("style",null,g)),n.createElement("div",{ref:xe,"data-input-otp-container":!0,style:ot,className:b},ct,n.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},it)))});st.displayName="Input";function se(t,s){try{t.insertRule(s)}catch{console.error("input-otp could not insert CSS rule:",s)}}var ys=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;function ws({className:t,containerClassName:s,...a}){return e.jsx(st,{"data-slot":"input-otp",containerClassName:ue("flex items-center gap-2 has-disabled:opacity-50",s),className:ue("disabled:cursor-not-allowed",t),...a})}function Cs({className:t,...s}){return e.jsx("div",{"data-slot":"input-otp-group",className:ue("flex items-center",t),...s})}function Y({index:t,className:s,...a}){const l=n.useContext(tt),{char:m,hasFakeCaret:c,isActive:h}=l?.slots[t]??{};return e.jsxs("div",{"data-slot":"input-otp-slot","data-active":h,className:ue("data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",s),...a,children:[m,c&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-caret-blink bg-foreground h-4 w-px duration-1000"})})]})}const Ss=5;function at(){const t=ve(),[s,a]=n.useState(""),[l,m]=n.useState(""),[c,h]=n.useState(!1),[o,r]=n.useState(null),[d,f]=n.useState(0),{currentUser:p,addJoinedProject:i}=U(),b=j=>{const v=j||new Date(Date.now()+Ss*60*1e3);r(v),f(Math.ceil(Math.max(0,v.getTime()-Date.now())/1e3/60));const F=setInterval(()=>{const z=Math.max(0,v.getTime()-Date.now());f(Math.ceil(z/1e3/60)),z<=0&&(r(null),m(""),clearInterval(F))},1e3)},g=j=>{a(j.toUpperCase()),m("")},S=async j=>{if(j.preventDefault(),!(!p||!s.trim()||o)){if(s.length!==6){m("Code must be 6 characters (letters and numbers only)");return}h(!0),m("");try{const v=await We({data:{userId:p.id,code:s.toUpperCase()}});if(!v.success){if("rateLimited"in v&&v.rateLimited){const ne="cooldownEnd"in v&&v.cooldownEnd?new Date(v.cooldownEnd):null;b(ne),m(v.error||"Too many attempts. Please try again later.")}else m(v.error||"Invalid code. Please check and try again."),E.error(v.error||"Invalid code");return}const F=v.projectId;i(F),"message"in v&&v.message==="Already a member of this project"||E.success(`Welcome to ${v.projectTitle||"the project"}!`,{description:"You have successfully joined."}),t({to:`/explorer/project/${F}`})}catch(v){console.error("Join project error:",v),m("Failed to join project. Please try again."),E.error("Failed to join project")}finally{h(!1)}}},k=o!==null||c;return e.jsx(X,{children:e.jsx(Z,{className:"p-5",children:e.jsxs("form",{onSubmit:S,className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(ws,{maxLength:6,value:s,onChange:g,disabled:k,inputMode:"text",pattern:"^[A-Za-z0-9]+$",children:e.jsxs(Cs,{children:[e.jsx(Y,{index:0,className:"uppercase font-mono"}),e.jsx(Y,{index:1,className:"uppercase font-mono"}),e.jsx(Y,{index:2,className:"uppercase font-mono"}),e.jsx(Y,{index:3,className:"uppercase font-mono"}),e.jsx(Y,{index:4,className:"uppercase font-mono"}),e.jsx(Y,{index:5,className:"uppercase font-mono"})]})}),e.jsx(V,{type:"submit",disabled:k||s.length!==6,children:c?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(Wt,{className:"w-4 h-4"})})]}),l&&!o&&e.jsxs(Fe,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(Be,{children:l})]}),o&&e.jsxs(Fe,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs(Be,{children:["Too many attempts. Please try again in ",d," minute",d!==1?"s":"","."]})]})]})})})}function Is(){const{currentUser:t}=U(),[s,a]=n.useState([]),[l,m]=n.useState(!0);n.useEffect(()=>{async function o(){if(t)try{const r=await ft({data:{userId:t.id}});if(r.success&&r.invitations){const d=r.invitations.map(f=>({id:f.id,projectId:f.projectId,projectName:f.projectTitle,invitedAt:f.createdAt,expiresAt:null}));a(d)}}catch(r){console.error("Failed to fetch invitations:",r)}finally{m(!1)}}o()},[t]);const c=o=>{a(r=>r.filter(d=>d.id!==o))};if(!t)return null;const h=s.length>0;return e.jsxs("div",{className:"container max-w-4xl mx-auto py-16 px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center mx-auto mb-6",children:e.jsx(_e,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-4xl font-bold text-foreground mb-4",children:["Welcome, ",t.name,"!"]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:l?"Checking for invitations...":h?"You have a project invitation waiting for you.":"Enter a join code to get started."})]}),l&&e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(q,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),!l&&h&&e.jsx("div",{className:"mb-8 space-y-4",children:s.map(o=>e.jsx(cs,{invitation:o,onDismiss:c},o.id))}),e.jsx(at,{}),e.jsx("div",{className:"mt-12 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don't have a join code?"," ",e.jsx("button",{className:"text-cyan-500 hover:text-cyan-400 underline",children:"Contact your creator"})]})})]})}const Ds={scheduled:{label:"Scheduled",className:"bg-amber-500/10 text-amber-500 border-amber-500/30"},opened:{label:"Opened",className:"bg-cyan-500/10 text-cyan-500 border-cyan-500/30"},closed:{label:"Closed",className:"bg-green-500/10 text-green-500 border-green-500/30"}};function nt({status:t}){const s=Ds[t];return e.jsx(St,{variant:"outline",className:`text-[10px] uppercase font-bold py-0 h-5 px-2 ${s.className}`,children:s.label})}function Ms(t,s){if(!t||!s)return null;const a=new Date(t).getTime(),l=new Date(s).getTime();if(isNaN(a)||isNaN(l)||l<=a)return null;const m=l-a,c=Math.floor(m/1e3),h=Math.floor(c/60),o=Math.floor(h/60),r=Math.floor(o/24);if(r>0){const d=o%24;return d>0?`${r}d ${d}h`:`${r}d`}if(o>0){const d=h%60;return d>0?`${o}h ${d}m`:`${o}h`}return h>0?`${h}m`:`${c}s`}function Es({project:t,open:s,onOpenChange:a}){const l=Ue(t.startDate,t.endDate),m=ze(t.startDate,t.endDate),c=Je(t.startDate,t.endDate),h=t.teamSize===1;return e.jsx(It,{open:s,onOpenChange:a,children:e.jsxs(Dt,{className:"!flex !flex-col max-w-lg max-h-[85vh] overflow-hidden",overlayClassName:"backdrop-blur-sm",children:[e.jsxs(Mt,{className:"shrink-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(nt,{status:l})}),e.jsx(Et,{className:"text-xl",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["By ",t.creatorName]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto -mx-6 px-6",children:e.jsxs("div",{className:"space-y-5 pb-2",children:[t.description&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-1 flex items-center gap-1.5",children:[e.jsx(Pt,{className:"w-3.5 h-3.5"}),"Description"]}),e.jsx("p",{className:"text-sm text-foreground",children:t.description})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-1.5",children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),"Timeline"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Start"}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:_(t.startDate,"MMM d, yyyy HH:mm","Not set")})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"End"}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:_(t.endDate,"MMM d, yyyy HH:mm","Not set")})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:[c.elapsed," elapsed"]}),e.jsxs("span",{children:[c.remaining," left"]})]}),e.jsx(be,{value:m,className:"h-1.5"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-1.5",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),"Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Type"}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:h?"Individual":"Group"})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Team"}),e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:t.teamName||"Unassigned"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Team Size"}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:t.teamSize})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Joined"}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:_(t.joinedAt,"MMM d, yyyy","?")})]})]})]}),t.sessions&&t.sessions.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-1.5",children:[e.jsx(Tt,{className:"w-3.5 h-3.5"}),"Sessions (",t.sessions.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:t.sessions.map((o,r)=>e.jsxs("div",{className:"flex items-center gap-3 p-2.5 rounded-lg bg-muted/50 border border-border",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-cyan-600/20 text-cyan-500 text-xs font-semibold rounded shrink-0",children:r+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:o.title}),(o.startDate||o.endDate)&&e.jsxs("div",{className:"text-[11px] text-muted-foreground flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),_(o.startDate,"MMM d HH:mm","TBD")," - ",_(o.endDate,"MMM d HH:mm","TBD"),(()=>{const d=Ms(o.startDate,o.endDate);return d?` (${d})`:""})()]})]})]},o.id))})]})]})})]})})}function ce({project:t}){const[s,a]=n.useState(!1),[l,m]=n.useState(!1),[,c]=n.useState(0),{notifications:h,markNotificationRead:o}=U();n.useEffect(()=>{const g=setInterval(()=>{c(S=>S+1)},1e3);return()=>clearInterval(g)},[]);const r=h.filter(g=>g.projectId===t.id&&!g.read),d=r.length,f=Ue(t.startDate,t.endDate),p=ze(t.startDate,t.endDate),i=Je(t.startDate,t.endDate),b=t.teamSize===1;return e.jsxs(e.Fragment,{children:[e.jsxs(X,{className:"bg-card border-border transition-all",children:[e.jsxs($t,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(nt,{status:f}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(V,{variant:"ghost",size:"icon",onClick:()=>m(!0),className:"h-8 w-8 text-muted-foreground hover:text-cyan-500 hover:bg-cyan-500/10",children:e.jsx(gt,{className:"w-4 h-4"})}),d>0&&e.jsxs(jt,{open:s,onOpenChange:a,children:[e.jsx(vt,{asChild:!0,children:e.jsxs(V,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground hover:bg-muted relative",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-red-500 text-white text-[10px] flex items-center justify-center",children:d>9?"9+":d})]})}),e.jsxs(bt,{className:"w-72 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Notifications (",d,")"]}),e.jsx(V,{variant:"ghost",size:"sm",className:"text-xs h-auto py-1",onClick:()=>{r.forEach(g=>o(g.id)),a(!1)},children:"Clear"})]}),e.jsx(yt,{className:"max-h-[200px]",children:r.map(g=>e.jsxs("div",{className:"p-3 border-b last:border-0 hover:bg-muted/50 cursor-pointer",onClick:()=>{o(g.id)},children:[e.jsx("p",{className:"text-sm font-medium",children:g.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:wt(new Date(g.createdAt),{addSuffix:!0})})]},g.id))})]})]})]})]}),e.jsx(Ge,{to:"/explorer/project/$projectId",params:{projectId:t.id},children:e.jsx("h3",{className:"text-lg font-semibold text-foreground line-clamp-1 hover:text-cyan-500 transition-colors cursor-pointer w-full",children:t.title})}),e.jsxs("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-1 w-full",children:["By ",t.creatorName]})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[b?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Ne,{className:"w-4 h-4"}),"Type"]}),e.jsx("span",{className:"text-foreground",children:b?"Individual":"Group"})]}),e.jsxs("div",{className:"flex items-center justify-between text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Sessions"]}),e.jsxs("span",{className:"text-foreground",children:[t.sessionCount," sessions"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Duration"]}),e.jsxs("span",{className:"text-foreground",children:[_(t.startDate,"MMM d HH:mm","TBD")," - ",_(t.endDate,"MMM d HH:mm","TBD")]})]})]}),e.jsxs("div",{className:"mt-5 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:[i.elapsed," elapsed"]}),e.jsxs("span",{children:[i.remaining," left"]})]}),e.jsx(be,{value:p,className:"h-2"})]})]})]}),e.jsx(Es,{project:t,open:l,onOpenChange:m})]})}function Ps({allProjects:t,scheduledProjects:s,openedProjects:a,closedProjects:l}){const[m,c]=n.useState("all"),[,h]=n.useState(0),o=n.useMemo(()=>{const r=d=>{if(!d)return Number.NEGATIVE_INFINITY;const f=new Date(d).getTime();return Number.isNaN(f)?Number.NEGATIVE_INFINITY:f};return[...t].sort((d,f)=>r(f.startDate)-r(d.startDate))},[t]);return n.useEffect(()=>{const r=setInterval(()=>{h(d=>d+1)},1e3);return()=>clearInterval(r)},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(kt,{className:"w-8 h-8 text-cyan-500"}),"My Projects"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your learning journey and project progress"})]}),e.jsxs(Ut,{value:m,onValueChange:r=>c(r),children:[e.jsxs(zt,{className:"mb-6",children:[e.jsxs(oe,{value:"all",className:"gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"All",t.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-slate-500/20 text-slate-400 rounded-full",children:t.length})]}),e.jsxs(oe,{value:"scheduled",className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Scheduled",s.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-amber-500/20 text-amber-400 rounded-full",children:s.length})]}),e.jsxs(oe,{value:"opened",className:"gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Opened",a.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-cyan-500/20 text-cyan-400 rounded-full",children:a.length})]}),e.jsxs(oe,{value:"closed",className:"gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Closed",l.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded-full",children:l.length})]})]}),e.jsx(ie,{value:"all",children:t.length===0?e.jsx(de,{type:"all"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(r=>e.jsx(ce,{project:r},r.id))})}),e.jsx(ie,{value:"opened",children:a.length===0?e.jsx(de,{type:"opened"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(r=>e.jsx(ce,{project:r},r.id))})}),e.jsx(ie,{value:"scheduled",children:s.length===0?e.jsx(de,{type:"scheduled"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(r=>e.jsx(ce,{project:r},r.id))})}),e.jsx(ie,{value:"closed",children:l.length===0?e.jsx(de,{type:"closed"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:l.map(r=>e.jsx(ce,{project:r},r.id))})})]})]})}function de({type:t}){const s=()=>{switch(t){case"all":return e.jsx(Ve,{className:"w-6 h-6 text-muted-foreground"});case"scheduled":return e.jsx(ae,{className:"w-6 h-6 text-muted-foreground"});case"opened":return e.jsx(qe,{className:"w-6 h-6 text-muted-foreground"});case"closed":return e.jsx(Xe,{className:"w-6 h-6 text-muted-foreground"})}},a=()=>{switch(t){case"all":return"No projects yet. Join a project using a code from your creator.";case"scheduled":return"You have no scheduled projects. Projects will appear here when they are scheduled to start.";case"opened":return"Join a project using a code from your creator.";case"closed":return"Your closed projects will appear here."}};return e.jsxs("div",{className:"text-center py-12 px-6 bg-muted/30 rounded-xl border border-dashed border-muted",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:s()}),e.jsxs("h3",{className:"text-lg font-medium text-foreground mb-2",children:["No ",t," projects"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a()})]})}const Ts={footprints:e.jsx(es,{className:"w-4 h-4"}),flag:e.jsx(Qt,{className:"w-4 h-4"}),compass:e.jsx(_e,{className:"w-4 h-4"}),star:e.jsx(Ze,{className:"w-4 h-4"}),sun:e.jsx(Ft,{className:"w-4 h-4"}),calendar:e.jsx(ae,{className:"w-4 h-4"}),"message-circle":e.jsx(Kt,{className:"w-4 h-4"}),"hand-helping":e.jsx(Zt,{className:"w-4 h-4"}),heart:e.jsx(Xt,{className:"w-4 h-4"}),brain:e.jsx(qt,{className:"w-4 h-4"}),megaphone:e.jsx(Vt,{className:"w-4 h-4"}),users:e.jsx(Ne,{className:"w-4 h-4"}),lightbulb:e.jsx(Yt,{className:"w-4 h-4"}),puzzle:e.jsx(Gt,{className:"w-4 h-4"})};function ks(){const{currentUser:t}=U();if(!t)return null;const s=i=>i.split(" ").map(b=>b[0]).join("").toUpperCase().slice(0,2),a=He.find(i=>i.level===t.level),l=He.find(i=>i.level===t.level+1),m=a?.xpRequired||0,c=l?.xpRequired||t.xp,h=t.xp-m,o=c-m,r=l?h/o*100:100,d=t.earnedBadgeIds??[],f=d.slice(-3).map(i=>Jt.find(b=>b.id===i)).filter(Boolean),p=Math.max(0,d.length-3);return e.jsx(X,{children:e.jsxs(Z,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(At,{className:"h-14 w-14",children:[e.jsx(Ot,{src:t.avatarUrl||void 0}),e.jsx(Lt,{className:"bg-gradient-to-br from-cyan-500 to-blue-600 text-white text-lg",children:s(t.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.name}),e.jsx(ke,{children:e.jsxs(Ae,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs("div",{className:"cursor-help",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Level ",t.level," ",a?.name]}),e.jsx("div",{className:"mt-1",children:e.jsx(be,{value:r,className:"h-1.5"})})]})}),e.jsx(Le,{children:e.jsxs("p",{className:"text-sm",children:[t.xp," XP",l&&e.jsxs(e.Fragment,{children:[" / ",c," XP to Level ",l.level]})]})})]})})]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{children:f.map(i=>i&&e.jsxs(Ae,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/10 flex items-center justify-center text-cyan-400",children:Ts[i.icon]||e.jsx(Ze,{className:"w-4 h-4"})})}),e.jsxs(Le,{children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description})]})]},i.id))}),p>0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["+",p," more"]})]}),e.jsxs(Ge,{to:"/explorer/portfolio",className:"flex items-center justify-between p-3 -mx-1 rounded-lg hover:bg-muted/50 transition-colors group",children:[e.jsx("span",{className:"text-sm font-medium text-cyan-500",children:"View Full Portfolio"}),e.jsx(ts,{className:"w-4 h-4 text-cyan-500 group-hover:translate-x-1 transition-transform"})]})]})})}function As(){const[t,s]=n.useState(new Date);return n.useEffect(()=>{const a=setInterval(()=>{s(new Date)},1e3);return()=>clearInterval(a)},[]),e.jsx(X,{children:e.jsxs(Z,{className:"p-5 text-center",children:[e.jsx("div",{className:"text-3xl font-bold font-mono text-foreground",children:je(t,"HH:mm:ss")}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:je(t,"EEEE, MMMM d, yyyy")})]})})}function Os(){const t=new Date,s=ss(t),a=Bt(t),l=Rt(s),m=as(a),c=ns({start:l,end:m}),h=["Su","Mo","Tu","We","Th","Fr","Sa"];return e.jsx(X,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-center",children:[h.map(o=>e.jsx("div",{className:"text-xs font-medium text-muted-foreground py-1",children:o},o)),c.map(o=>{const r=rs(o,t),d=ls(o,t);return e.jsx("div",{className:`
                  text-xs py-1 rounded
                  ${!r&&"text-muted-foreground/40"}
                  ${d&&"bg-primary text-primary-foreground font-bold"}
                `,children:je(o,"d")},o.toISOString())})]})})})}function Ls(){const{currentUser:t}=U(),{isLoadingProjects:s,projectsError:a,fetchUserProjects:l,getAllUserProjects:m,getScheduledProjects:c,getOpenedProjects:h,getClosedProjects:o}=_t();if(n.useEffect(()=>{if(!t?.id)return;l(t.id);const i=setInterval(()=>{l(t.id)},1e4);return()=>clearInterval(i)},[t?.id,l]),!t)return null;const r=m(),d=c(),f=h(),p=o();return e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:s?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(q,{className:"w-6 h-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading projects..."})]}):a?e.jsxs("div",{className:"text-center py-12 text-destructive",children:[e.jsx("p",{children:a}),e.jsx("button",{onClick:()=>l(t.id),className:"mt-2 text-sm underline",children:"Try again"})]}):e.jsx(Ps,{allProjects:r,scheduledProjects:d,openedProjects:f,closedProjects:p})}),e.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:[e.jsx(ks,{}),e.jsx(As,{}),e.jsx(Os,{}),e.jsx(at,{})]})]})})}function qs(){const t=ve(),{isAuthenticated:s,currentUser:a,addJoinedProject:l}=U(),[m,c]=n.useState(!0),[h,o]=n.useState(!1),[r]=n.useState(()=>{if(typeof window>"u")return null;const i=new URLSearchParams(window.location.search).get("joinCode");return i&&i.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6)||null}),d=n.useRef(!1);if(n.useEffect(()=>{if(!s)if(r){const p=encodeURIComponent(`/explorer?joinCode=${r}`);t({to:`/signin?redirect_uri=${p}`})}else t({to:"/signin"})},[s,r,t]),n.useEffect(()=>{if(!s||!a||!r||d.current)return;d.current=!0,(async()=>{try{const i=await We({data:{userId:a.id,code:r}});if(!i.success){const g=i.error||"Invalid join code. Please check and try again.";E.error(g);return}l(i.projectId),"message"in i&&i.message==="Already a member of this project"||E.success(`Welcome to ${i.projectTitle||"the project"}!`,{description:"You have successfully joined."}),t({to:`/explorer/project/${i.projectId}`})}catch(i){console.error("Join project error:",i),E.error("Failed to join project. Please try again.")}})()},[l,a,s,r,t]),n.useEffect(()=>{async function p(){if(a)try{const i=await Ht({data:{userId:a.id}});i.success&&i.projects?o(i.projects.length>0):o(a.joinedProjectIds?.length>0)}catch(i){console.error("Failed to fetch user projects:",i),o(a.joinedProjectIds?.length>0)}finally{c(!1)}}p()},[a]),!a)return null;if(m)return e.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-background flex items-center justify-center",children:e.jsx(q,{className:"w-8 h-8 animate-spin text-muted-foreground"})});const f=!h;return e.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-background",children:f?e.jsx(Is,{}):e.jsx(Ls,{})})}export{qs as component};
