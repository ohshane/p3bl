import{u as te,a as se,r as d,a2 as M,a1 as re,a0 as i,aD as T,j as e,e as ne,D as O,k as x,B as k,d as W,aE as S,E as ae,ai as oe}from"./main-oBfCarfk.js";import{u as de}from"./projectStore-Dn8I5Khp.js";import{a as N,i as A,s as le,b as ie}from"./subMonths-B6J82qdx.js";import{C as ce}from"./chevron-left-DsCZXPGL.js";import{C as xe}from"./chevron-right-DzRrl-eW.js";import{L as me}from"./list-checks-D31XoYpK.js";import{E as ue}from"./external-link-CsvnNyN7.js";import{s as he,e as B,a as F,b as j,i as fe}from"./isSameMonth-RY1uWspo.js";function De(){const w=te(),{currentUser:C}=se(),{userProjects:u,fetchUserProjects:H,isLoadingProjects:K}=de(),[m,z]=d.useState("month"),[l,h]=d.useState(()=>new Date(2026,1,1)),[f,g]=d.useState(()=>new Date(2026,1,1)),[U,V]=d.useState(!1);d.useEffect(()=>{V(!0);const t=new Date;h(t),g(t)},[]),d.useEffect(()=>{C?.id&&u.length===0&&H(C.id)},[C?.id,H,u.length]);const b=d.useMemo(()=>{const t=M(l);return Array.from({length:7}).map((n,s)=>N(t,s))},[l]),Y=d.useMemo(()=>{if(m==="month"){const t=M(he(l)),n=B(re(l));return F({start:t,end:n})}else return b},[l,m,b]),E=d.useMemo(()=>{const t={};return u.forEach(n=>{if(n.startDate&&n.endDate)try{const s=new Date(n.startDate),r=new Date(n.endDate);if(isNaN(s.getTime())||isNaN(r.getTime()))return;const a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),o=new Date(r.getFullYear(),r.getMonth(),r.getDate());F({start:a,end:o}).forEach(v=>{const p=i(v,"yyyy-MM-dd");t[p]||(t[p]=[]),t[p].find(I=>I.id===n.id)||t[p].push(n)})}catch{const r=i(new Date(n.startDate),"yyyy-MM-dd");t[r]||(t[r]=[]),t[r].find(a=>a.id===n.id)||t[r].push(n)}}),t},[u]),_=()=>{h(m==="month"?ie(l,1):N(l,7))},q=()=>{h(m==="month"?le(l):N(l,-7))},G=()=>{const t=new Date;h(t),g(t)},L=d.useMemo(()=>{const t=i(f,"yyyy-MM-dd");return[...E[t]||[]].sort((s,r)=>new Date(s.startDate).getTime()-new Date(r.startDate).getTime())},[f,E]),[$,J]=d.useState(new Date);d.useEffect(()=>{const t=setInterval(()=>J(new Date),6e4);return()=>clearInterval(t)},[]);const Q=d.useMemo(()=>($.getHours()*60+$.getMinutes())/1440*100,[$]),R=d.useMemo(()=>Array.from({length:24}).map((t,n)=>n),[]),X=d.useRef(null),P=d.useMemo(()=>{const t=M(l),n=B(l),s=[],r=[];return u.forEach(a=>{if(!a.startDate||!a.endDate)return;const o=new Date(a.startDate),c=new Date(a.endDate);o<n&&c>t&&(T(c,o)>=1440||!j(o,c)?s.push(a):r.push(a))}),{allDay:s,timed:r}},[u,l]);return!U||K&&u.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your schedule..."})]})}):e.jsxs("div",{className:"container max-w-7xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(O,{className:"w-8 h-8 text-cyan-500"}),"My Calendar"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View your project timelines and upcoming session deadlines"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-muted rounded-lg p-1 mr-2",children:[e.jsx("button",{onClick:()=>z("month"),className:x("px-3 py-1.5 text-xs font-bold rounded-md transition-all",m==="month"?"bg-background shadow-sm text-cyan-600":"text-muted-foreground hover:text-foreground"),children:"Month"}),e.jsx("button",{onClick:()=>z("week"),className:x("px-3 py-1.5 text-xs font-bold rounded-md transition-all",m==="week"?"bg-background shadow-sm text-cyan-600":"text-muted-foreground hover:text-foreground"),children:"Week"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-card border border-border p-1 rounded-lg",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:G,className:"text-xs font-semibold",children:"Today"}),e.jsxs("div",{className:"flex items-center border-l border-border pl-2",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:q,className:"h-8 w-8",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("span",{className:"min-w-[140px] text-center font-bold text-sm",children:m==="month"?i(l,"MMMM yyyy"):`Week of ${i(M(l),"MMM d")}`}),e.jsx(k,{variant:"ghost",size:"icon",onClick:_,className:"h-8 w-8",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})]})]}),m==="month"&&e.jsxs("div",{className:"bg-card border border-border rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-border bg-muted/30",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"py-3 text-center text-xs font-bold text-muted-foreground uppercase tracking-widest",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 divide-x divide-y divide-border border-l border-t border-transparent",children:Y.map(t=>{const n=i(t,"yyyy-MM-dd"),s=E[n]||[],r=fe(t,l),a=j(t,f);return e.jsxs("div",{onClick:()=>g(t),className:x("min-h-[140px] p-2 transition-colors cursor-pointer relative hover:bg-muted/5",r?"bg-card":"bg-muted/10 text-muted-foreground/50",a&&"bg-cyan-500/5 ring-2 ring-inset ring-cyan-500"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:x("text-sm font-semibold rounded-full w-7 h-7 flex items-center justify-center",A(t)?"bg-cyan-600 text-white shadow-lg shadow-cyan-600/20":r?"text-muted-foreground":"text-muted-foreground/30"),children:i(t,"d")}),s.length>0&&e.jsx(W,{variant:"secondary",className:"h-5 px-1.5 text-[10px] font-bold bg-muted/50 text-muted-foreground",children:s.length})]}),e.jsx("div",{className:"space-y-1 overflow-y-auto max-h-[100px] scrollbar-none",children:s.map(o=>e.jsx("button",{onClick:c=>{c.stopPropagation(),w({to:`/explorer/project/${o.id}`})},className:"w-full text-left p-1.5 rounded bg-purple-500/10 border border-purple-500/20 hover:bg-purple-400 hover:text-white transition-all group cursor-pointer",children:e.jsx("div",{className:"text-[10px] font-bold text-purple-600 group-hover:text-white truncate uppercase tracking-tighter",children:o.title})},`proj-indicator-${t.toISOString()}-${o.id}`))})]},`cell-${t.toISOString()}`)})})]}),m==="week"&&e.jsxs("div",{className:"bg-card border border-border rounded-xl overflow-hidden shadow-sm flex flex-col h-[calc(100vh-350px)] min-h-[500px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/30",children:[e.jsx("div",{className:"w-16 flex-shrink-0 border-r border-border"}),e.jsx("div",{className:"flex-1 grid grid-cols-7",children:b.map((t,n)=>{const s=j(t,f);return e.jsxs("div",{onClick:()=>g(t),className:x("text-center py-3 transition-colors cursor-pointer relative hover:bg-muted/5",s?"bg-cyan-500/5 ring-2 ring-inset ring-cyan-500":"",n<6&&!s&&"border-r border-border"),children:[e.jsx("div",{className:x("text-[10px] uppercase font-bold tracking-widest",s?"text-cyan-600":"text-muted-foreground"),children:i(t,"EEE")}),e.jsx("div",{className:x("inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold mt-1",A(t)?"bg-cyan-600 text-white shadow-md":s?"text-cyan-600":"text-foreground"),children:i(t,"d")})]},t.toISOString())})})]}),P.allDay.length>0&&e.jsxs("div",{className:"flex border-b border-border",children:[e.jsx("div",{className:"w-16 flex-shrink-0 border-r border-border bg-muted/5 flex items-center justify-center text-[10px] text-muted-foreground font-medium p-2",children:"All-day"}),e.jsx("div",{className:"flex-1 p-0 grid grid-cols-7 bg-muted/5",children:b.map((t,n)=>{const s=P.allDay.filter(r=>{const a=new Date(r.startDate),o=new Date(r.endDate);return t>=S(a)&&t<=S(o)});return e.jsx("div",{onClick:()=>g(t),className:x("p-0.5 min-h-[32px] gap-0.5 cursor-pointer transition-colors relative hover:bg-muted/5 flex flex-col",n<6&&"border-r border-border/50"),children:s.map(r=>e.jsx("button",{onClick:a=>{a.stopPropagation(),w({to:`/explorer/project/${r.id}`})},className:"w-full bg-purple-500/10 text-purple-600 text-[9px] px-1.5 py-1 truncate shadow-sm hover:bg-purple-400 hover:text-white border border-purple-500/20 transition-all text-left rounded-sm cursor-pointer group",children:e.jsx("span",{className:"font-bold uppercase tracking-tighter",children:r.title})},r.id))},`allday-${t.toISOString()}`)})})]}),e.jsx("div",{ref:X,className:"flex-1 overflow-hidden relative",children:e.jsxs("div",{className:"flex h-full relative",children:[e.jsx("div",{className:"w-16 flex-shrink-0 border-r border-border bg-muted/5 text-[10px] text-muted-foreground select-none relative z-20 h-full flex flex-col",children:R.map(t=>e.jsx("div",{className:"flex-1 border-b border-border/50 text-right pr-2 relative",children:e.jsx("span",{className:"-top-2 absolute right-2",children:i(new Date().setHours(t,0,0,0),"ha")})},t))}),e.jsxs("div",{className:"flex-1 grid grid-cols-7 relative h-full",children:[e.jsxs("div",{className:"absolute left-0 right-0 z-40 pointer-events-none flex items-center",style:{top:`${Q}%`},children:[e.jsx("div",{className:"absolute -left-1 w-2 h-2 rounded-full bg-red-500 z-50"}),e.jsx("div",{className:"w-full h-0.5 bg-red-500"})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col pointer-events-none",children:R.map(t=>e.jsx("div",{className:"flex-1 border-b border-border/50 w-full"},t))}),b.map((t,n)=>e.jsx("div",{className:x("relative h-full transition-colors cursor-pointer hover:bg-muted/5",n<6&&"border-r border-border"),onClick:()=>g(t),children:P.timed.filter(s=>{const r=new Date(s.startDate),a=new Date(s.endDate),o=S(t),c=N(o,1);return r<c&&a>o}).map(s=>{const r=new Date(s.startDate),a=new Date(s.endDate),o=S(t),c=N(o,1),v=r<o?o:r,p=a>c?c:a,I=v.getHours()*60+v.getMinutes(),Z=T(p,v),y=j(r,t),D=j(a,t);return e.jsxs("div",{style:{top:`${I/1440*100}%`,height:`${Math.max(Z/1440*100,2)}%`,minHeight:"32px"},className:x("absolute inset-x-1 bg-purple-500/10 text-purple-600 text-[10px] p-1.5 overflow-hidden shadow-sm border border-purple-500/20 z-10 cursor-pointer hover:bg-purple-500 hover:text-white transition-all group",y&&D&&"rounded",y&&!D&&"rounded-t",!y&&D&&"rounded-b",!y&&!D&&"rounded-none"),onClick:ee=>{ee.stopPropagation(),w({to:`/explorer/project/${s.id}`})},children:[e.jsx("div",{className:"font-bold truncate uppercase tracking-tighter group-hover:text-white",children:s.title}),e.jsxs("div",{className:"text-[9px] opacity-90 truncate group-hover:text-white",children:[s.sessionCount," sessions"]})]},`project-${s.id}-${t.toISOString()}`)})},t.toISOString()))]})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-bold text-xl text-foreground flex items-center gap-2",children:[e.jsx(ae,{className:"w-6 h-6 text-cyan-500"}),"Active Projects on ",i(f,"MMMM d, yyyy")]}),A(f)&&e.jsx(W,{className:"bg-cyan-500 hover:bg-cyan-600",children:"Today"})]}),e.jsx("div",{className:"space-y-4",children:L.length>0?L.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-muted/20 hover:bg-muted/40 transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-purple-500/10 border border-purple-500/20 flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-foreground",children:t.title}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3.5 h-3.5"}),t.startDate?i(new Date(t.startDate),"MMM d, HH:mm"):"N/A"," - ",t.endDate?i(new Date(t.endDate),"MMM d, HH:mm"):"N/A",t.startDate&&t.endDate&&(()=>{const n=T(new Date(t.endDate),new Date(t.startDate));if(n<60)return e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["(",n,"m)"]});const s=Math.floor(n/60),r=n%60;if(s<24)return e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["(",r>0?`${s}h ${r}m`:`${s}h`,")"]});const a=Math.floor(s/24),o=s%24;return e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["(",o>0?`${a}d ${o}h`:`${a}d`,")"]})})()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3.5 h-3.5"}),t.sessionCount," sessions"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(k,{onClick:()=>w({to:`/explorer/project/${t.id}`}),className:"bg-cyan-600 hover:bg-cyan-700 text-white gap-2",children:["Enter Project",e.jsx(ue,{className:"w-4 h-4"})]})})]},`selected-proj-${t.id}`)):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-border rounded-xl",children:[e.jsx(O,{className:"w-12 h-12 text-muted-foreground/20 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No projects scheduled for this date."})]})})]})})]})}export{De as component};
