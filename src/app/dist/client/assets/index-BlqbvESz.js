import{c as ne,r as a,j as e,H as X,J as K,K as W,M as Y,aa as Z,I as F,ag as T,af as $,m as M,ab as Q,B as N,e as I,aT as oe,aU as ce,aV as de,U as ie,aW as _,aX as q,aY as z,aZ as J,a_ as y,d as me,at as xe,au as ue,av as he,aw as H,a6 as pe,a$ as ge,a8 as je,b0 as be,b1 as fe,b2 as Ne,b3 as ve,b4 as ye,b5 as we,b6 as Ce,b7 as Se,b8 as De}from"./main-oBfCarfk.js";import{L as A}from"./label-D--meCET.js";import{A as ee,a as se}from"./alert-C8I4vCtu.js";import{C as ae}from"./circle-alert-CGSAmO4T.js";import{E as Ue}from"./eye-off-BCX6L8Ou.js";import{E as ke}from"./eye-BcuVz-Uk.js";import{U as Ae}from"./user-plus-BpqqDICJ.js";import{S as Re}from"./search-D4fCj5l3.js";import{C as Ee}from"./chevron-left-DsCZXPGL.js";import{C as Fe}from"./chevron-right-DzRrl-eW.js";const Le=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Ie=ne("ellipsis-vertical",Le),Pe=[{value:"admin",label:"Admin",description:"Full system access including user management",icon:T,colorClass:"text-amber-400"},{value:"creator",label:"Creator",description:"Can create projects, sessions, and manage explorers",icon:$,colorClass:"text-purple-400"},{value:"explorer",label:"Explorer",description:"Can join projects and complete learning activities",icon:M,colorClass:"text-cyan-400"}];function Oe({open:D,onOpenChange:w,onUserCreated:n}){const[C,x]=a.useState(""),[d,o]=a.useState(""),[h,p]=a.useState(""),[g,j]=a.useState(""),[S,b]=a.useState(["explorer"]),[u,t]=a.useState(!1),[l,i]=a.useState(!1),[m,U]=a.useState(null),v=()=>{x(""),o(""),p(""),j(""),b(["explorer"]),t(!1),U(null)},P=r=>{b(c=>c.includes(r)?c.length<=1?c:c.filter(f=>f!==r):[...c,r])},O=async r=>{r.preventDefault(),i(!0),U(null);try{const c=await oe({data:{name:C.trim(),username:d.trim(),email:h.trim(),password:g,role:S}});c.success?(v(),w(!1),n()):U(c.error)}catch{U("Failed to create user")}finally{i(!1)}},R=r=>{r||v(),w(r)};return e.jsx(X,{open:D,onOpenChange:R,children:e.jsxs(K,{className:"bg-card border-border sm:max-w-md",children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Create New User"}),e.jsx(Z,{className:"text-muted-foreground",children:"Add a new user to the system. They will receive login credentials."})]}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[m&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(se,{children:m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"name",children:"Full Name"}),e.jsx(F,{id:"name",value:C,onChange:r=>x(r.target.value),placeholder:"John Doe",className:"bg-background border-border",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"username",children:"Username"}),e.jsx(F,{id:"username",value:d,onChange:r=>o(r.target.value),placeholder:"johndoe",className:"bg-background border-border",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(F,{id:"email",type:"email",value:h,onChange:r=>p(r.target.value),placeholder:"user@example.com",className:"bg-background border-border",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:"password",type:u?"text":"password",value:g,onChange:r=>j(r.target.value),placeholder:"Minimum 8 characters",className:"bg-background border-border pr-10",minLength:8,required:!0}),e.jsx("button",{type:"button",onClick:()=>t(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:u?e.jsx(Ue,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Roles"}),e.jsx("div",{className:"space-y-2",children:Pe.map(r=>{const c=r.icon,f=S.includes(r.value),k=f&&S.length<=1;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${f?"border-cyan-500/50 bg-cyan-500/5":"border-border bg-background hover:bg-muted/50"} ${k?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>P(r.value),disabled:k,className:"mt-1 rounded border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:`w-4 h-4 ${r.colorClass}`}),e.jsx("span",{className:"font-medium text-foreground text-sm",children:r.label})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:r.description})]})]},r.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"At least one role must be selected."})]}),e.jsxs(Q,{children:[e.jsx(N,{type:"button",variant:"ghost",onClick:()=>R(!1),disabled:l,children:"Cancel"}),e.jsx(N,{type:"submit",className:"bg-cyan-600 hover:bg-cyan-700",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create User"})]})]})]})})}const G=[{value:"admin",label:"Admin",description:"Full system access including user management",icon:T,colorClass:"text-amber-400"},{value:"creator",label:"Creator",description:"Can create projects, sessions, and manage explorers",icon:$,colorClass:"text-purple-400"},{value:"explorer",label:"Explorer",description:"Can join projects and complete learning activities",icon:M,colorClass:"text-cyan-400"}];function Te({open:D,onOpenChange:w,user:n,onRoleUpdated:C}){const[x,d]=a.useState(n?.role??["explorer"]),[o,h]=a.useState(!1),[p,g]=a.useState(null);a.useState(()=>{n&&d([...n.role])});const j=t=>{d(l=>l.includes(t)?l.length<=1?l:l.filter(i=>i!==t):[...l,t])},S=()=>n?x.length!==n.role.length?!0:!x.every(t=>n.role.includes(t)):!1,b=async t=>{if(t.preventDefault(),!!n){h(!0),g(null);try{const l=await ce({data:{userId:n.id,role:x}});l.success?(w(!1),C()):g(l.error)}catch{g("Failed to update roles")}finally{h(!1)}}},u=t=>{t?n&&d([...n.role]):g(null),w(t)};return n?e.jsx(X,{open:D,onOpenChange:u,children:e.jsxs(K,{className:"bg-card border-border sm:max-w-md",children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Change User Roles"}),e.jsxs(Z,{className:"text-muted-foreground",children:["Update the roles for ",n.name]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[p&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(se,{children:p})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium text-foreground",children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.email}),e.jsx("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:n.role.map(t=>{const l=G.find(m=>m.value===t);if(!l)return null;const i=l.icon;return e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(i,{className:`w-3.5 h-3.5 ${l.colorClass}`}),l.label]},t)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Roles"}),e.jsx("div",{className:"space-y-2",children:G.map(t=>{const l=t.icon,i=x.includes(t.value),m=i&&x.length<=1;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${i?"border-cyan-500/50 bg-cyan-500/5":"border-border bg-background hover:bg-muted/50"} ${m?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>j(t.value),disabled:m,className:"mt-1 rounded border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:`w-4 h-4 ${t.colorClass}`}),e.jsx("span",{className:"font-medium text-foreground text-sm",children:t.label})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:t.description})]})]},t.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"At least one role must be selected."})]}),e.jsxs(Q,{children:[e.jsx(N,{type:"button",variant:"ghost",onClick:()=>u(!1),disabled:o,children:"Cancel"}),e.jsx(N,{type:"submit",className:"bg-cyan-600 hover:bg-cyan-700",disabled:o||!S(),children:o?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Roles"})]})]})]})}):null}function Xe(){const[D,w]=a.useState([]),[n,C]=a.useState(!0),[x,d]=a.useState(null),[o,h]=a.useState(1),[p,g]=a.useState(1),[j,S]=a.useState(0),b=10,[u,t]=a.useState(""),[l,i]=a.useState("all"),[m,U]=a.useState("createdAt"),[v,P]=a.useState("desc"),[O,R]=a.useState(!1),[r,c]=a.useState(null),[f,k]=a.useState(null),[B,V]=a.useState(!1),E=a.useCallback(async()=>{C(!0),d(null);try{const s=await de({data:{page:o,limit:b,search:u||void 0,role:l==="all"?void 0:l,sortBy:m,sortOrder:v}});s.success?(w(s.users),S(s.total),g(s.totalPages)):d(s.error)}catch{d("Failed to load users")}finally{C(!1)}},[o,b,u,l,m,v]);a.useEffect(()=>{E()},[E]),a.useEffect(()=>{h(1)},[u,l,m,v]);const re=async()=>{if(f){V(!0);try{const s=await De({data:{userId:f}});s.success?E():d(s.error)}catch{d("Failed to delete user")}finally{V(!1),k(null)}}},te=s=>{switch(s){case"admin":return"bg-amber-500/10 text-amber-400 border-amber-500/20";case"creator":return"bg-purple-500/10 text-purple-400 border-purple-500/20";default:return"bg-cyan-500/10 text-cyan-400 border-cyan-500/20"}},le=s=>{switch(s){case"admin":return e.jsx(T,{className:"w-3 h-3"});case"creator":return e.jsx($,{className:"w-3 h-3"});default:return e.jsx(M,{className:"w-3 h-3"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(ie,{className:"w-8 h-8 text-cyan-500"}),"User Management"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[j," ",j===1?"user":"users"," total"]})]}),e.jsxs(N,{className:"bg-cyan-600 hover:bg-cyan-700 text-white",onClick:()=>R(!0),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Add User"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 bg-card border border-border rounded-xl p-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search by name or email...",value:u,onChange:s=>t(s.target.value),className:"pl-10 bg-background border-border"})]})}),e.jsxs(_,{value:l,onValueChange:i,children:[e.jsx(q,{className:"w-[150px] bg-background border-border",children:e.jsx(z,{placeholder:"All Roles"})}),e.jsxs(J,{className:"bg-popover border-border",children:[e.jsx(y,{value:"all",children:"All Roles"}),e.jsx(y,{value:"explorer",children:"Explorer"}),e.jsx(y,{value:"creator",children:"Creator"}),e.jsx(y,{value:"admin",children:"Admin"})]})]}),e.jsxs(_,{value:m,onValueChange:s=>U(s),children:[e.jsx(q,{className:"w-[140px] bg-background border-border",children:e.jsx(z,{})}),e.jsxs(J,{className:"bg-popover border-border",children:[e.jsx(y,{value:"createdAt",children:"Date Joined"}),e.jsx(y,{value:"name",children:"Name"}),e.jsx(y,{value:"email",children:"Email"}),e.jsx(y,{value:"role",children:"Role"})]})]}),e.jsx(N,{variant:"outline",size:"icon",className:"border-border",onClick:()=>P(v==="asc"?"desc":"asc"),children:v==="asc"?"↑":"↓"})]}),x&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-xl p-4 text-destructive",children:x}),e.jsxs("div",{className:"bg-card border border-border rounded-xl overflow-hidden",children:[n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})}):D.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No users found"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Level"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:D.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-foreground font-medium",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.username]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.role.map(L=>e.jsxs(me,{className:`${te(L)} gap-1`,children:[le(L),L]},L))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-foreground font-medium",children:s.level}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",s.xp," XP)"]})]})}),e.jsx("td",{className:"px-6 py-4 text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(xe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ie,{className:"w-4 h-4"})})}),e.jsxs(he,{align:"end",className:"bg-popover border-border",children:[e.jsxs(H,{className:"text-popover-foreground focus:text-foreground focus:bg-muted",onClick:()=>c(s),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Change Role"]}),e.jsx(ge,{className:"bg-border"}),e.jsxs(H,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>k(s.id),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Delete User"]})]})]})})]},s.id))})]}),p>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-border",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",(o-1)*b+1," to ",Math.min(o*b,j)," of ",j," users"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",className:"border-border",onClick:()=>h(o-1),disabled:o===1,children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-muted-foreground px-2",children:["Page ",o," of ",p]}),e.jsx(N,{variant:"outline",size:"sm",className:"border-border",onClick:()=>h(o+1),disabled:o===p,children:e.jsx(Fe,{className:"w-4 h-4"})})]})]})]}),e.jsx(Oe,{open:O,onOpenChange:R,onUserCreated:E}),e.jsx(Te,{open:!!r,onOpenChange:s=>!s&&c(null),user:r,onRoleUpdated:E}),e.jsx(be,{open:!!f,onOpenChange:s=>!s&&k(null),children:e.jsxs(fe,{className:"bg-card border-border",children:[e.jsxs(Ne,{children:[e.jsx(ve,{className:"text-foreground",children:"Delete User"}),e.jsx(ye,{className:"text-muted-foreground",children:"Are you sure you want to delete this user? This action cannot be undone. All user data including projects, artifacts, and progress will be permanently deleted."})]}),e.jsxs(we,{children:[e.jsx(Ce,{className:"border-border text-muted-foreground hover:bg-muted",children:"Cancel"}),e.jsx(Se,{className:"bg-red-600 hover:bg-red-700",onClick:re,disabled:B,children:B?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete User"})]})]})})]})}export{Xe as component};
