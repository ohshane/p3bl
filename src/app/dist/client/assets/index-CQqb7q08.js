import{c as te,u as ae,a as re,a4 as oe,r as o,j as e,a7 as le,I as w,e as C,Q as ne,B as i,d as $,a8 as ie,aj as ce,H as L,J as F,K as H,M as E,aa as R,ab as O,E as B,D as G,aI as de,aJ as me,aK as ue,t as c,a0 as D,aL as Q,aM as he,aN as xe}from"./main-oBfCarfk.js";import{C as U,b as pe,a as ge}from"./card-C5iuDLNY.js";import{S as fe}from"./search-D4fCj5l3.js";import{G as je}from"./globe-Bq2dtVyB.js";import{R as A}from"./rocket-CSH0mYHf.js";const be=[["path",{d:"M15.686 15A14.5 14.5 0 0 1 12 22a14.5 14.5 0 0 1 0-20 10 10 0 1 0 9.542 13",key:"qkt0x6"}],["path",{d:"M2 12h8.5",key:"ovaggd"}],["path",{d:"M20 6V4a2 2 0 1 0-4 0v2",key:"1of5e8"}],["rect",{width:"8",height:"5",x:"14",y:"6",rx:"1",key:"1fmf51"}]],ye=te("globe-lock",be);function z(r){if(r<60)return`${r} minutes`;if(r<1440){const t=Math.floor(r/60),l=r%60;return l>0?`${t}h ${l}m`:`${t} hour${t>1?"s":""}`}else if(r<10080){const t=Math.floor(r/1440),l=Math.floor(r%1440/60);return l>0?`${t}d ${l}h`:`${t} day${t>1?"s":""}`}else{const t=Math.floor(r/10080),l=Math.floor(r%10080/1440);return l>0?`${t}w ${l}d`:`${t} week${t>1?"s":""}`}}function Ne(){const r=ae(),{currentUser:t}=re(),{fetchProjects:l}=oe(),[J,b]=o.useState([]),[K,T]=o.useState(!0),[u,_]=o.useState(""),[x,g]=o.useState(null),[M,k]=o.useState(null),[n,f]=o.useState(null),[m,S]=o.useState(""),[h,y]=o.useState(""),[N,I]=o.useState(!1);o.useEffect(()=>{async function s(){if(t?.id){T(!0);try{const a=await de({data:{creatorId:t.id}});a.success&&b(a.templates||[])}catch(a){console.error("Failed to fetch templates:",a)}finally{T(!1)}}}s()},[t?.id]);const P=J.filter(s=>s.title.toLowerCase().includes(u.toLowerCase())||s.description?.toLowerCase().includes(u.toLowerCase())),j=o.useMemo(()=>n?.sessions?n.sessions.reduce((s,a)=>s+(a.durationMinutes||0),0):0,[n]),q=s=>{const a=new Date;a.setMinutes(Math.ceil(a.getMinutes()/15)*15,0,0);const d=D(a,"yyyy-MM-dd'T'HH:mm"),v=(s.sessions||[]).reduce((ee,se)=>ee+(se.durationMinutes||0),0),p=Q(a,v||60),Z=D(p,"yyyy-MM-dd'T'HH:mm");S(d),y(Z),f(s)},V=s=>{if(S(s),s&&j>0){const a=new Date(s),d=Q(a,j);y(D(d,"yyyy-MM-dd'T'HH:mm"))}},Y=async()=>{if(!(!n||!t?.id||!m||!h)){I(!0);try{const s=await xe({data:{templateId:n.id,creatorId:t.id,startDate:new Date(m).toISOString(),endDate:new Date(h).toISOString()}});s.success&&s.projectId?(c.success("Project deployed from template!"),f(null),await l(t.id),r({to:"/creator/project/$projectId",params:{projectId:s.projectId}})):c.error(s.error||"Failed to deploy template")}catch(s){console.error("Deploy template error:",s),c.error("Failed to deploy template")}finally{I(!1)}}},W=async()=>{if(x)try{(await he({data:{projectId:x.id}})).success?(b(a=>a.filter(d=>d.id!==x.id)),c.success("Template removed from library")):c.error("Failed to remove template")}catch(s){console.error("Failed to delete template:",s),c.error("Failed to remove template")}finally{g(null)}},X=async s=>{if(t?.id){k(s.id);try{const a=s.isPublished,d=a?await me({data:{templateId:s.id,creatorId:t.id}}):await ue({data:{templateId:s.id,creatorId:t.id}});d.success?(b(v=>v.map(p=>p.id===s.id?{...p,isPublished:!a}:p)),c.success(a?"Template unpublished from store":"Template published to store!")):c.error(d.error||"Failed to update publish status")}catch(a){console.error("Toggle publish error:",a),c.error("Failed to update publish status")}finally{k(null)}}};return e.jsxs("div",{className:"container max-w-7xl mx-auto py-8 px-4",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(le,{className:"w-8 h-8 text-cyan-500"}),"Project Library"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your project templates and reuse proven structures"})]})}),e.jsxs("div",{className:"relative mb-8",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(w,{placeholder:"Search templates...",value:u,onChange:s=>_(s.target.value),className:"pl-10 h-12 bg-card border-border"})]}),K?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(C,{className:"w-10 h-10 animate-spin text-cyan-500 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading templates..."})]}):P.length===0?e.jsxs(U,{className:"border-dashed py-20 flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(ne,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No templates found"}),e.jsx("p",{className:"text-muted-foreground max-w-sm mb-6",children:u?`No templates matching "${u}"`:"You haven't added any templates yet. Click the library icon on any project card to save it as a template."}),!u&&e.jsx(i,{onClick:()=>r({to:"/creator"}),variant:"outline",children:"Go to Dashboard"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.map(s=>e.jsxs(U,{className:"bg-card border-border hover:border-cyan-500/50 transition-all group",children:[e.jsxs(pe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx($,{variant:"secondary",className:"bg-cyan-500/10 text-cyan-500 border-none",children:"Template"}),s.isPublished&&e.jsx($,{variant:"secondary",className:"bg-violet-500/10 text-violet-500 border-none",children:"Published"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.sessionCount," sessions"]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>X(s),disabled:M===s.id,className:`h-7 w-7 ${s.isPublished?"text-violet-500 hover:text-violet-400 hover:bg-violet-500/10":"text-muted-foreground hover:text-violet-500 hover:bg-violet-500/10"}`,title:s.isPublished?"Unpublish from store":"Publish to store",children:M===s.id?e.jsx(C,{className:"w-4 h-4 animate-spin"}):s.isPublished?e.jsx(ye,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>g({id:s.id,title:s.title}),className:"h-7 w-7 text-muted-foreground hover:text-red-400 hover:bg-red-500/10",title:"Remove template",children:e.jsx(ie,{className:"w-4 h-4"})})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-foreground line-clamp-1 group-hover:text-cyan-500 transition-colors cursor-pointer",onClick:()=>r({to:"/creator/library/$id",params:{id:s.id}}),children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mt-1",children:s.description||s.drivingQuestion})]}),e.jsx(ge,{children:e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(i,{className:"flex-1 bg-cyan-600 hover:bg-cyan-700 text-white",onClick:()=>q(s),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Use Template"]}),e.jsx(i,{variant:"outline",className:"flex-none",onClick:()=>r({to:"/creator/library/$id",params:{id:s.id}}),children:"Edit"})]})})]},s.id))}),e.jsx(L,{open:!!x,onOpenChange:s=>!s&&g(null),children:e.jsxs(F,{className:"bg-card border-border",children:[e.jsxs(H,{children:[e.jsx(E,{children:"Remove Template"}),e.jsxs(R,{children:['Are you sure you want to remove "',x?.title,'" from your library? This action cannot be undone.']})]}),e.jsxs(O,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(null),children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:W,children:"Remove"})]})]})}),e.jsx(L,{open:!!n,onOpenChange:s=>{s||f(null)},children:e.jsxs(F,{className:"bg-card border-border sm:max-w-md",children:[e.jsxs(H,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-cyan-500"}),"Deploy Project"]}),e.jsx(R,{children:"Set the start and end time to create a live project from this template."})]}),n&&e.jsxs("div",{className:"space-y-5 py-2",children:[e.jsxs("div",{className:"p-3 bg-muted/40 rounded-lg border border-border",children:[e.jsx("p",{className:"font-medium text-foreground text-sm",children:n.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-1.5 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[n.sessionCount," sessions"]}),j>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),z(j)]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1.5 flex items-center gap-1.5",children:[e.jsx(G,{className:"w-3.5 h-3.5 text-muted-foreground"}),"Start Date & Time"]}),e.jsx(w,{type:"datetime-local",value:m,onChange:s=>V(s.target.value),className:"bg-background border-border"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1.5 flex items-center gap-1.5",children:[e.jsx(G,{className:"w-3.5 h-3.5 text-muted-foreground"}),"End Date & Time"]}),e.jsx(w,{type:"datetime-local",value:h,min:m,onChange:s=>y(s.target.value),className:"bg-background border-border"})]}),m&&h&&e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 bg-gradient-to-r from-cyan-500/10 to-blue-500/10 rounded-lg border border-cyan-500/20",children:[e.jsx(B,{className:"w-4 h-4 text-cyan-500 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:z(Math.max(0,Math.round((new Date(h).getTime()-new Date(m).getTime())/6e4)))}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"total project duration"})]})]})]}),e.jsxs(O,{className:"gap-2 sm:gap-0",children:[e.jsx(i,{variant:"outline",onClick:()=>f(null),disabled:N,children:"Cancel"}),e.jsx(i,{className:"bg-cyan-600 hover:bg-cyan-700 text-white",onClick:Y,disabled:N||!m||!h,children:N?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Deploying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Deploy Project"]})})]})]})})]})}function Me(){return e.jsx(Ne,{})}export{Me as component};
